import urllib.parse
import replicate
import html
import re
import requests
import random
import langdetect
import faker


def rubino(url: str, timeout: float = 10) -> dict:
    '''This method is used to get the download link
    and other information of the post(s) in Rubino Messenger
    :param url:
        The link of the desired post
    :param timeout:
        Optional To manage slow timeout when the server is slow
    :return:
        Full post information

    If you want more details, go to this address: https://github.com/metect/myrino
    '''
    auth_list: list = []
    payload: dict = {
        'api_version': '0',
        'auth': random.choice(seq=auth_list),
        'client': {
            'app_name': 'Main',
            'app_version': '3.0.1',
            'package': 'app.rubino.main',
            'lang_code': 'en',
            'platform': 'PWA'
    },
        'data': {
            'share_link': url.split('/')[-1],
            'profile_id': None
        },
        'method': 'getPostByShareLink'
    }
    session = requests.session()
    base_url: str = f'https://rubino{random.randint(1, 20)}.iranlms.ir/'
    return session.request('post', url=base_url, timeout=timeout, json=payload).json()


def font(text: str = 'ohmyapi') -> dict:
    '''This function is for generating fonts. Currently only English language is supported
    :param text:
        The text you want the font to be applied to
    '''
    fonts: dict = {
        "0": ["ð”ž", "ð”Ÿ", "ð” ", "ð”¡", "ð”¢", "ð”£", "ð”¤", "ð”¥", "ð”¦", "ð”§", "ð”¨", "ð”©", "ð”ª", "ð”«", "ð”¬", "ð”­", "ð”®", "ð”¯", "ð”°", "ð”±", "ð”²", "ð”³", "ð”´", "ð”µ", "ð”¶", "ð”·"],
        "1": ["ð“ª", "ð“«", "ð“¬", "ð“­", "ð“®", "ð“¯", "ð“°", "ð“±", "ð“²", "ð“³", "ð“´", "ð“µ", "ð“¶", "ð“·", "ð“¸", "ð“¹", "ð“º", "ð“»", "ð“¼", "ð“½", "ð“¾", "ð“¿", "ð”€", "ð”", "ð”‚", "ð”ƒ"],
        "2": ["ð’¶", "ð’·", "ð’¸", "ð’¹", "ð‘’", "ð’»", "ð‘”", "ð’½", "ð’¾", "ð’¿", "ð“€", "ð“", "ð“‚", "ð“ƒ", "ð‘œ", "ð“…", "ð“†", "ð“‡", "ð“ˆ", "ð“‰", "ð“Š", "ð“‹", "ð“Œ", "ð“", "ð“Ž", "ð“"],
        "3": ["ð•’", "ð•“", "ð•”", "ð••", "ð•–", "ð•—", "ð•˜", "ð•™", "ð•š", "ð•›", "ð•œ", "ð•", "ð•ž", "ð•Ÿ", "ð• ", "ð•¡", "ð•¢", "ð•£", "ð•¤", "ð•¥", "ð•¦", "ð•§", "ð•¨", "ð•©", "ð•ª", "ð•«"],
        "4": ["á´€", "Ê™", "á´„", "á´…", "á´‡", "êœ°", "É¢", "Êœ", "Éª", "á´Š", "á´‹", "ÊŸ", "á´", "É´", "á´", "á´˜", "Q", "Ê€", "êœ±", "á´›", "á´œ", "á´ ", "á´¡", "x", "Ê", "á´¢"],
        "5": ["â“", "â“‘", "â“’", "â““", "â“”", "â“•", "â“–", "â“—", "â“˜", "â“™", "â“š", "â“›", "â“œ", "â“", "â“ž", "â“Ÿ", "â“ ", "â“¡", "â“¢", "â“£", "â“¤", "â“¥", "â“¦", "â“§", "â“¨", "â“©"],
        "6": ["ðš", "ð›", "ðœ", "ð", "ðž", "ðŸ", "ð ", "ð¡", "ð¢", "ð£", "ð¤", "ð¥", "ð¦", "ð§", "ð¨", "ð©", "ðª", "ð«", "ð¬", "ð­", "ð®", "ð¯", "ð°", "ð±", "ð²", "ð³"],
        "7": ["ð—®", "ð—¯", "ð—°", "ð—±", "ð—²", "ð—³", "ð—´", "ð—µ", "ð—¶", "ð—·", "ð—¸", "ð—¹", "ð—º", "ð—»", "ð—¼", "ð—½", "ð—¾", "ð—¿", "ð˜€", "ð˜", "ð˜‚", "ð˜ƒ", "ð˜„", "ð˜…", "ð˜†", "ð˜‡"],
        "8": ["ð’‚", "ð’ƒ", "ð’„", "ð’…", "ð’†", "ð’‡", "ð’ˆ", "ð’‰", "ð’Š", "ð’‹", "ð’Œ", "ð’", "ð’Ž", "ð’", "ð’", "ð’‘", "ð’’", "ð’“", "ð’”", "ð’•", "ð’–", "ð’—", "ð’˜", "ð’™", "ð’š", "ð’›"],
        "9": ["Î±", "É“", "à«®", "âˆ‚", "Îµ", "Æ’", "É ", "É¦", "à¹€", "Ê", "Ò¡", "â„“", "É±", "É³", "Ïƒ", "Ï", "Ï†", "à«¨", "à¸£", "Æ­", "Âµ", "Ñµ", "Ï‰", "×", "áƒ§", "Æ¶"],
        "10": ["ã€Aã€‘", "ã€Bã€‘", "ã€Cã€‘", "ã€Dã€‘", "ã€Eã€‘", "ã€Fã€‘", "ã€Gã€‘", "ã€Hã€‘", "ã€Iã€‘", "ã€Jã€‘", "ã€Kã€‘", "ã€Lã€‘", "ã€Mã€‘", "ã€Nã€‘", "ã€Oã€‘", "ã€Pã€‘", "ã€Qã€‘", "ã€Rã€‘", "ã€Sã€‘", "ã€Tã€‘", "ã€Uã€‘", "ã€Vã€‘", "ã€Wã€‘", "ã€Xã€‘", "ã€Yã€‘", "ã€Zã€‘"],
        "11": ["â’œ", "â’", "â’ž", "â’Ÿ", "â’ ", "â’¡", "â’¢", "â’£", "â’¤", "â’¥", "â’¦", "â’§", "â’¨", "â’©", "â’ª", "â’«", "â’¬", "â’­", "â’®", "â’¯", "â’°", "â’±", "â’²", "â’³", "â’´", "â’µ"],
        "12": ["áµƒ", "áµ‡", "á¶œ", "áµˆ", "áµ‰", "á¶ ", "áµ", "Ê°", "á¶¦", "Ê²", "áµ", "Ë¡", "áµ", "â¿", "áµ’", "áµ–", "á‘«", "Ê³", "Ë¢", "áµ—", "áµ˜", "áµ›", "Ê·", "Ë£", "Ê¸", "á¶»"],
        "13": ["â’¶", "â’·", "â’¸", "â’¹", "â’º", "â’»", "â’¼", "â’½", "â’¾", "â’¿", "â“€", "â“", "â“‚", "â“ƒ", "â“„", "â“…", "â“†", "â“‡", "â“ˆ", "â“‰", "â“Š", "â“‹", "â“Œ", "â“", "â“Ž", "â“"],
        "14": ["ð€", "ð", "ð‚", "ðƒ", "ð„", "ð…", "ð†", "ð‡", "ðˆ", "ð‰", "ðŠ", "ð‹", "ðŒ", "ð", "ðŽ", "ð", "ð", "ð‘", "ð’", "ð“", "ð”", "ð•", "ð–", "ð—", "ð˜", "ð™"],
        "15": ["ð•¬", "ð•­", "ð•®", "ð•¯", "ð•°", "ð•±", "ð•²", "ð•³", "ð•¿", "ð•´", "ð•¶", "ð•·", "ð•¸", "ð•¹", "ð•º", "ð•»", "ð•¼", "ð•½", "ð•¾", "ð•µ", "ð–€", "ð–", "ð–‚", "ð–ƒ", "ðš¼", "ð–…"],
        "16": ["ð˜¼", "ð˜½", "ð˜¾", "ð˜¿", "ð™€", "ð™", "ð™‚", "ð™ƒ", "ð™„", "ð™…", "ð™†", "ð™‡", "ð™ˆ", "ð™‰", "ð™Š", "ð™‹", "ð™Œ", "ð™", "ð™Ž", "ð™", "ð™", "ð™‘", "ð™’", "ð™“", "ð™”", "ð™•"],
        "17": ["ð“", "ð“‘", "ð“’", "ð““", "ð“”", "ð“•", "ð“–", "ð“—", "ð“˜", "ð“™", "ð“š", "ð“›", "ð“œ", "ð“", "ð“ž", "ð“Ÿ", "ð“ ", "ð“¡", "ð“¢", "ð“£", "ð“¤", "ð“¥", "ð“¦", "ð“§", "ð“¨", "ð“©"],
        "18": ["ð’œ", "â„¬", "ð’ž", "ð’Ÿ", "â„°", "â„±", "ð’¢", "â„‹", "â„", "ð’¥", "ð’¦", "â„’", "â„³", "ð’©", "ð’ª", "ð’«", "ð’¬", "â„›", "ð’®", "ð’¯", "ð’°", "ð’±", "ð’²", "ð’³", "ð’´"],
        "19": ["ð”¸", "ð”¹", "â„‚", "ð”»", "ð”¼", "ð”½", "ð”¾", "â„", "ð•€", "ð•", "ð•‚", "ð•ƒ", "ð•„", "â„•", "ð•†", "â„™", "â„š", "â„", "ð•Š", "ð•‹", "ð•Œ", "ð•", "ð•Ž", "ð•", "ð•", "â„¤"],
        "20": ["ï¼¡", "ï¼¢", "ï¼£", "ï¼¤", "ï¼¥", "ï¼¦", "ï¼§", "ï¼¨", "ï¼©", "ï¼ª", "ï¼«", "ï¼¬", "ï¼­", "ï¼®", "ï¼¯", "ï¼°", "ï¼±", "ï¼²", "ï¼³", "ï¼´", "ï¼µ", "ï¼¶", "ï¼·", "ï¼¸", "ï¼¹", "ï¼º"],
        "21": ["á´€", "Ê™", "á´„", "á´…", "á´‡", "Ò“", "É¢", "Êœ", "Éª", "á´Š", "á´‹", "ÊŸ", "á´", "É´", "á´", "á´˜", "Ç«", "Ê€", "s", "á´›", "á´œ", "á´ ", "á´¡", "x", "Ê", "á´¢"],
        "22": ["á´¬", "á´®", "á¶œ", "á´°", "á´±", "á¶ ", "á´³", "á´´", "á´µ", "á´¶", "á´·", "á´¸", "á´¹", "á´º", "á´¼", "á´¾", "áµŸ", "á´¿", "Ë¢", "áµ€", "áµ", "â±½", "áµ‚", "Ë£", "áµž", "á¶»"],
        "23": ["å‚", "ä¹ƒ", "åŒš", "åˆ€", "ä¹‡", "ä¸‹", "åŽ¶", "å„", "å·¥", "ä¸", "é•¿", "ä¹š", "ä»Ž", "ð ˜¨", "å£", "å°¸", "ã”¿", "å°º", "ä¸‚", "ä¸…", "å‡µ", "ãƒª", "å±±", "ä¹‚", "ä¸«", "ä¹™"],
        "24": ["ã€Žaã€", "ã€Žbã€", "ã€Žcã€", "ã€Ždã€", "ã€Žeã€", "ã€Žfã€", "ã€Žgã€", "ã€Žhã€", "ã€Žiã€", "ã€Žjã€", "ã€Žkã€", "ã€Žlã€", "ã€Žmã€", "ã€Žnã€", "ã€Žoã€", "ã€Žpã€", "ã€Žqã€", "ã€Žrã€", "ã€Žsã€", "ã€Žtã€", "ã€Žuã€", "ã€Žvã€", "ã€Žwã€", "ã€Žxã€", "ã€Žyã€", "ã€Žzã€"],
        "25": ["aâ™¥", "bâ™¥", "câ™¥", "dâ™¥", "eâ™¥", "fâ™¥", "gâ™¥", "hâ™¥", "iâ™¥", "jâ™¥", "kâ™¥", "lâ™¥", "mâ™¥", "nâ™¥", "oâ™¥", "pâ™¥", "qâ™¥", "râ™¥", "sâ™¥", "tâ™¥", "uâ™¥", "vâ™¥", "wâ™¥", "xâ™¥", "yâ™¥", "zâ™¥"],
        "26": ["ð•’", "Î²", "Ï‚", "á—ª", "ð‘’", "ð”£", "ð”¾", "â„", "á¶¤", "ð•", "Òœ", "Ë¡", "ð•ž", "Î®", "ð”¬", "â“…", "ðª", "Å˜", "ð“¢", "Å£", "ï¼µ", "á¯", "Ï‰", "ð”µ", "ã„š", "ï½š"],
        "27": ["Î”", "ð’·", "Ï‚", "â““", "ð’†", "ð“•", "ð‘”", "â“—", "ð¢", "â’¿", "ð•œ", "â„“", "â“‚", "Å‡", "Ã˜", "å©", "á»£", "ð“‡", "Ñ•", "ï½”", "ð®", "ð“‹", "ð”€", "ð•©", "Ñƒ", "ð“©"],
        "28": ["ð”¸", "áµ‡", "Ï‚", "ð”»", "ð’†", "Æ’", "Ä£", "Ñ’", "ð¢", "ð‰", "ð¤", "Ë¡", "Ð¼", "â„•", "áµ’", "×§", "ðª", "ð”¯", "à¸£", "â“£", "â“¤", "ï½–", "á—¯", "ð•©", "â“¨", "z"],
        "29": ["Î±", "ð”Ÿ", "á‘•", "Ä‘", "Ñ”", "Ò“", "ð ", "Ä¦", "ï¼©", "ð“™", "Ðº", "Ä¹", "Ð¼", "ð“", "ï¼¯", "ï½", "ð“ ", "ð“¡", "ð”°", "Å£", "Ã¹", "ð•", "ð°", "Ï‡", "ï½™", "Å¾"],
        "30": ["ð’¶", "ð’·", "ð” ", "ï¼¤", "ï½…", "â“•", "g", "â’½", "Î¯", "Ú¶", "â“š", "ð“µ", "ð•„", "Î®", "ð‘œ", "Æ¤", "ð“ ", "ð“»", "ð’", "â“£", "ï¼µ", "×©", "ï½—", "ï½˜", "â“Ž", "Å½"],
        "31": ["â’¶", "ð•“", "ð“¬", "Ä", "â“”", "ð’‡", "g", "ð•™", "à¹€", "ï¼ª", "á›•", "á’ª", "ð“‚", "â“", "ð•†", "Æ¤", "ð“†", "Ð³", "ð’", "Ñ‚", "Ç—", "ð¯", "Å´", "ð—", "ð•ª", "ï¼º"],
        "32": ["â“", "ð”¹", "ð‚", "â’¹", "ð’†", "â„±", "â’¼", "ï¼¨", "á¶¤", "ð£", "ï½‹", "â“", "ð“¶", "Å‡", "ðŽ", "â“Ÿ", "â“ ", "Ê³", "Åœ", "Å£", "á»®", "ï½–", "ð”´", "Ð–", "Â¥", "ï½š"]
    }

    converted_text = ''
    for count in range(0, len(fonts)):
        for char in text:
            if char.isalpha():
                char_index = ord(char.lower()) - 97
                converted_text += fonts[str(count)][char_index]
            else:
                converted_text += char

        converted_text += '\n'
        result = converted_text.split('\n')[0:-1]

    return result


def lang(text: str) -> str:
    '''This function is to identify the language of a text
    :param text:
        Your desired text
    :return:
        example: `en` or `fa`
    '''
    try:
        return langdetect.detect(text)
    except langdetect.LangDetectException:
        return 'The value of the text parameter you sent is integer. While you should have sent string'


def translator(text: str, to_lang: str = 'auto', from_lang: str = 'auto') -> dict:
    '''This API, which is based on the Google Translate API, is used to translate texts'''
    session = requests.session()
    base_url: str = 'https://translate.google.com'
    url: str = f'{base_url}/m?tl={to_lang}&sl={from_lang}&q={urllib.parse.quote(text)}'
    r = session.request(
        method='get', url=url, headers={
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'
        }
    )

    if r.status_code == 200:
        result = re.findall(r'(?s)class="(?:t0|result-container)">(.*?)<', r.text)
        return html.unescape(result[0])
    else:
        return 'A problem has occurred'


def fake(count: int = 100, lang: str = 'en_US') -> str:
    '''This api is used to generate fake text
    :param count
        Number of words, example >>> `10`
    :param lang
        desired language, example >>> `en_US` or `fa_IR`

    Power taken from the library `Faker`
    '''
    return faker.Faker([lang]).text()
