import urllib.parse
import replicate
import html
import re
import requests
import random
import langdetect
import faker


def rubino(url: str, timeout: float = 10) -> dict:
    '''This method is used to get the download link
    and other information of the post(s) in Rubino Messenger
    :param url:
        The link of the desired post
    :param timeout:
        Optional To manage slow timeout when the server is slow
    :return:
        Full post information

    If you want more details, go to this address: https://github.com/metect/myrino
    '''
    auth_list: list = []
    payload: dict = {
        'api_version': '0',
        'auth': random.choice(seq=auth_list),
        'client': {
            'app_name': 'Main',
            'app_version': '3.0.1',
            'package': 'app.rubino.main',
            'lang_code': 'en',
            'platform': 'PWA'
    },
        'data': {
            'share_link': url.split('/')[-1],
            'profile_id': None
        },
        'method': 'getPostByShareLink'
    }
    session = requests.session()
    base_url: str = f'https://rubino{random.randint(1, 20)}.iranlms.ir/'
    return session.request('post', url=base_url, timeout=timeout, json=payload).json()


def font(text: str = 'ohmyapi') -> dict:
    '''This function is for generating fonts. Currently only English language is supported
    :param text:
        The text you want the font to be applied to
    '''
    fonts: dict = {
        "0": ["ğ”", "ğ”Ÿ", "ğ” ", "ğ”¡", "ğ”¢", "ğ”£", "ğ”¤", "ğ”¥", "ğ”¦", "ğ”§", "ğ”¨", "ğ”©", "ğ”ª", "ğ”«", "ğ”¬", "ğ”­", "ğ”®", "ğ”¯", "ğ”°", "ğ”±", "ğ”²", "ğ”³", "ğ”´", "ğ”µ", "ğ”¶", "ğ”·"],
        "1": ["ğ“ª", "ğ“«", "ğ“¬", "ğ“­", "ğ“®", "ğ“¯", "ğ“°", "ğ“±", "ğ“²", "ğ“³", "ğ“´", "ğ“µ", "ğ“¶", "ğ“·", "ğ“¸", "ğ“¹", "ğ“º", "ğ“»", "ğ“¼", "ğ“½", "ğ“¾", "ğ“¿", "ğ”€", "ğ”", "ğ”‚", "ğ”ƒ"],
        "2": ["ğ’¶", "ğ’·", "ğ’¸", "ğ’¹", "ğ‘’", "ğ’»", "ğ‘”", "ğ’½", "ğ’¾", "ğ’¿", "ğ“€", "ğ“", "ğ“‚", "ğ“ƒ", "ğ‘œ", "ğ“…", "ğ“†", "ğ“‡", "ğ“ˆ", "ğ“‰", "ğ“Š", "ğ“‹", "ğ“Œ", "ğ“", "ğ“", "ğ“"],
        "3": ["ğ•’", "ğ•“", "ğ•”", "ğ••", "ğ•–", "ğ•—", "ğ•˜", "ğ•™", "ğ•š", "ğ•›", "ğ•œ", "ğ•", "ğ•", "ğ•Ÿ", "ğ• ", "ğ•¡", "ğ•¢", "ğ•£", "ğ•¤", "ğ•¥", "ğ•¦", "ğ•§", "ğ•¨", "ğ•©", "ğ•ª", "ğ•«"],
        "4": ["á´€", "Ê™", "á´„", "á´…", "á´‡", "êœ°", "É¢", "Êœ", "Éª", "á´Š", "á´‹", "ÊŸ", "á´", "É´", "á´", "á´˜", "Q", "Ê€", "êœ±", "á´›", "á´œ", "á´ ", "á´¡", "x", "Ê", "á´¢"],
        "5": ["â“", "â“‘", "â“’", "â““", "â“”", "â“•", "â“–", "â“—", "â“˜", "â“™", "â“š", "â“›", "â“œ", "â“", "â“", "â“Ÿ", "â“ ", "â“¡", "â“¢", "â“£", "â“¤", "â“¥", "â“¦", "â“§", "â“¨", "â“©"],
        "6": ["ğš", "ğ›", "ğœ", "ğ", "ğ", "ğŸ", "ğ ", "ğ¡", "ğ¢", "ğ£", "ğ¤", "ğ¥", "ğ¦", "ğ§", "ğ¨", "ğ©", "ğª", "ğ«", "ğ¬", "ğ­", "ğ®", "ğ¯", "ğ°", "ğ±", "ğ²", "ğ³"],
        "7": ["ğ—®", "ğ—¯", "ğ—°", "ğ—±", "ğ—²", "ğ—³", "ğ—´", "ğ—µ", "ğ—¶", "ğ—·", "ğ—¸", "ğ—¹", "ğ—º", "ğ—»", "ğ—¼", "ğ—½", "ğ—¾", "ğ—¿", "ğ˜€", "ğ˜", "ğ˜‚", "ğ˜ƒ", "ğ˜„", "ğ˜…", "ğ˜†", "ğ˜‡"],
        "8": ["ğ’‚", "ğ’ƒ", "ğ’„", "ğ’…", "ğ’†", "ğ’‡", "ğ’ˆ", "ğ’‰", "ğ’Š", "ğ’‹", "ğ’Œ", "ğ’", "ğ’", "ğ’", "ğ’", "ğ’‘", "ğ’’", "ğ’“", "ğ’”", "ğ’•", "ğ’–", "ğ’—", "ğ’˜", "ğ’™", "ğ’š", "ğ’›"],
        "9": ["Î±", "É“", "à«®", "âˆ‚", "Îµ", "Æ’", "É ", "É¦", "à¹€", "Ê", "Ò¡", "â„“", "É±", "É³", "Ïƒ", "Ï", "Ï†", "à«¨", "à¸£", "Æ­", "Âµ", "Ñµ", "Ï‰", "×", "áƒ§", "Æ¶"],
        "10": ["ã€Aã€‘", "ã€Bã€‘", "ã€Cã€‘", "ã€Dã€‘", "ã€Eã€‘", "ã€Fã€‘", "ã€Gã€‘", "ã€Hã€‘", "ã€Iã€‘", "ã€Jã€‘", "ã€Kã€‘", "ã€Lã€‘", "ã€Mã€‘", "ã€Nã€‘", "ã€Oã€‘", "ã€Pã€‘", "ã€Qã€‘", "ã€Rã€‘", "ã€Sã€‘", "ã€Tã€‘", "ã€Uã€‘", "ã€Vã€‘", "ã€Wã€‘", "ã€Xã€‘", "ã€Yã€‘", "ã€Zã€‘"],
        "11": ["â’œ", "â’", "â’", "â’Ÿ", "â’ ", "â’¡", "â’¢", "â’£", "â’¤", "â’¥", "â’¦", "â’§", "â’¨", "â’©", "â’ª", "â’«", "â’¬", "â’­", "â’®", "â’¯", "â’°", "â’±", "â’²", "â’³", "â’´", "â’µ"],
        "12": ["áµƒ", "áµ‡", "á¶œ", "áµˆ", "áµ‰", "á¶ ", "áµ", "Ê°", "á¶¦", "Ê²", "áµ", "Ë¡", "áµ", "â¿", "áµ’", "áµ–", "á‘«", "Ê³", "Ë¢", "áµ—", "áµ˜", "áµ›", "Ê·", "Ë£", "Ê¸", "á¶»"],
        "13": ["â’¶", "â’·", "â’¸", "â’¹", "â’º", "â’»", "â’¼", "â’½", "â’¾", "â’¿", "â“€", "â“", "â“‚", "â“ƒ", "â“„", "â“…", "â“†", "â“‡", "â“ˆ", "â“‰", "â“Š", "â“‹", "â“Œ", "â“", "â“", "â“"],
        "14": ["ğ€", "ğ", "ğ‚", "ğƒ", "ğ„", "ğ…", "ğ†", "ğ‡", "ğˆ", "ğ‰", "ğŠ", "ğ‹", "ğŒ", "ğ", "ğ", "ğ", "ğ", "ğ‘", "ğ’", "ğ“", "ğ”", "ğ•", "ğ–", "ğ—", "ğ˜", "ğ™"],
        "15": ["ğ•¬", "ğ•­", "ğ•®", "ğ•¯", "ğ•°", "ğ•±", "ğ•²", "ğ•³", "ğ•¿", "ğ•´", "ğ•¶", "ğ•·", "ğ•¸", "ğ•¹", "ğ•º", "ğ•»", "ğ•¼", "ğ•½", "ğ•¾", "ğ•µ", "ğ–€", "ğ–", "ğ–‚", "ğ–ƒ", "ğš¼", "ğ–…"],
        "16": ["ğ˜¼", "ğ˜½", "ğ˜¾", "ğ˜¿", "ğ™€", "ğ™", "ğ™‚", "ğ™ƒ", "ğ™„", "ğ™…", "ğ™†", "ğ™‡", "ğ™ˆ", "ğ™‰", "ğ™Š", "ğ™‹", "ğ™Œ", "ğ™", "ğ™", "ğ™", "ğ™", "ğ™‘", "ğ™’", "ğ™“", "ğ™”", "ğ™•"],
        "17": ["ğ“", "ğ“‘", "ğ“’", "ğ““", "ğ“”", "ğ“•", "ğ“–", "ğ“—", "ğ“˜", "ğ“™", "ğ“š", "ğ“›", "ğ“œ", "ğ“", "ğ“", "ğ“Ÿ", "ğ“ ", "ğ“¡", "ğ“¢", "ğ“£", "ğ“¤", "ğ“¥", "ğ“¦", "ğ“§", "ğ“¨", "ğ“©"],
        "18": ["ğ’œ", "â„¬", "ğ’", "ğ’Ÿ", "â„°", "â„±", "ğ’¢", "â„‹", "â„", "ğ’¥", "ğ’¦", "â„’", "â„³", "ğ’©", "ğ’ª", "ğ’«", "ğ’¬", "â„›", "ğ’®", "ğ’¯", "ğ’°", "ğ’±", "ğ’²", "ğ’³", "ğ’´"],
        "19": ["ğ”¸", "ğ”¹", "â„‚", "ğ”»", "ğ”¼", "ğ”½", "ğ”¾", "â„", "ğ•€", "ğ•", "ğ•‚", "ğ•ƒ", "ğ•„", "â„•", "ğ•†", "â„™", "â„š", "â„", "ğ•Š", "ğ•‹", "ğ•Œ", "ğ•", "ğ•", "ğ•", "ğ•", "â„¤"],
        "20": ["ï¼¡", "ï¼¢", "ï¼£", "ï¼¤", "ï¼¥", "ï¼¦", "ï¼§", "ï¼¨", "ï¼©", "ï¼ª", "ï¼«", "ï¼¬", "ï¼­", "ï¼®", "ï¼¯", "ï¼°", "ï¼±", "ï¼²", "ï¼³", "ï¼´", "ï¼µ", "ï¼¶", "ï¼·", "ï¼¸", "ï¼¹", "ï¼º"],
        "21": ["á´€", "Ê™", "á´„", "á´…", "á´‡", "Ò“", "É¢", "Êœ", "Éª", "á´Š", "á´‹", "ÊŸ", "á´", "É´", "á´", "á´˜", "Ç«", "Ê€", "s", "á´›", "á´œ", "á´ ", "á´¡", "x", "Ê", "á´¢"],
        "22": ["á´¬", "á´®", "á¶œ", "á´°", "á´±", "á¶ ", "á´³", "á´´", "á´µ", "á´¶", "á´·", "á´¸", "á´¹", "á´º", "á´¼", "á´¾", "áµŸ", "á´¿", "Ë¢", "áµ€", "áµ", "â±½", "áµ‚", "Ë£", "áµ", "á¶»"],
        "23": ["å‚", "ä¹ƒ", "åŒš", "åˆ€", "ä¹‡", "ä¸‹", "å¶", "å„", "å·¥", "ä¸", "é•¿", "ä¹š", "ä»", "ğ ˜¨", "å£", "å°¸", "ã”¿", "å°º", "ä¸‚", "ä¸…", "å‡µ", "ãƒª", "å±±", "ä¹‚", "ä¸«", "ä¹™"],
        "24": ["ã€aã€", "ã€bã€", "ã€cã€", "ã€dã€", "ã€eã€", "ã€fã€", "ã€gã€", "ã€hã€", "ã€iã€", "ã€jã€", "ã€kã€", "ã€lã€", "ã€mã€", "ã€nã€", "ã€oã€", "ã€pã€", "ã€qã€", "ã€rã€", "ã€sã€", "ã€tã€", "ã€uã€", "ã€vã€", "ã€wã€", "ã€xã€", "ã€yã€", "ã€zã€"],
        "25": ["aâ™¥", "bâ™¥", "câ™¥", "dâ™¥", "eâ™¥", "fâ™¥", "gâ™¥", "hâ™¥", "iâ™¥", "jâ™¥", "kâ™¥", "lâ™¥", "mâ™¥", "nâ™¥", "oâ™¥", "pâ™¥", "qâ™¥", "râ™¥", "sâ™¥", "tâ™¥", "uâ™¥", "vâ™¥", "wâ™¥", "xâ™¥", "yâ™¥", "zâ™¥"],
        "26": ["ğ•’", "Î²", "Ï‚", "á—ª", "ğ‘’", "ğ”£", "ğ”¾", "â„", "á¶¤", "ğ•", "Òœ", "Ë¡", "ğ•", "Î®", "ğ”¬", "â“…", "ğª", "Å˜", "ğ“¢", "Å£", "ï¼µ", "á¯", "Ï‰", "ğ”µ", "ã„š", "ï½š"],
        "27": ["Î”", "ğ’·", "Ï‚", "â““", "ğ’†", "ğ“•", "ğ‘”", "â“—", "ğ¢", "â’¿", "ğ•œ", "â„“", "â“‚", "Å‡", "Ã˜", "å©", "á»£", "ğ“‡", "Ñ•", "ï½”", "ğ®", "ğ“‹", "ğ”€", "ğ•©", "Ñƒ", "ğ“©"],
        "28": ["ğ”¸", "áµ‡", "Ï‚", "ğ”»", "ğ’†", "Æ’", "Ä£", "Ñ’", "ğ¢", "ğ‰", "ğ¤", "Ë¡", "Ğ¼", "â„•", "áµ’", "×§", "ğª", "ğ”¯", "à¸£", "â“£", "â“¤", "ï½–", "á—¯", "ğ•©", "â“¨", "z"],
        "29": ["Î±", "ğ”Ÿ", "á‘•", "Ä‘", "Ñ”", "Ò“", "ğ ", "Ä¦", "ï¼©", "ğ“™", "Ğº", "Ä¹", "Ğ¼", "ğ“", "ï¼¯", "ï½", "ğ“ ", "ğ“¡", "ğ”°", "Å£", "Ã¹", "ğ•", "ğ°", "Ï‡", "ï½™", "Å¾"],
        "30": ["ğ’¶", "ğ’·", "ğ” ", "ï¼¤", "ï½…", "â“•", "g", "â’½", "Î¯", "Ú¶", "â“š", "ğ“µ", "ğ•„", "Î®", "ğ‘œ", "Æ¤", "ğ“ ", "ğ“»", "ğ’", "â“£", "ï¼µ", "×©", "ï½—", "ï½˜", "â“", "Å½"],
        "31": ["â’¶", "ğ•“", "ğ“¬", "Ä", "â“”", "ğ’‡", "g", "ğ•™", "à¹€", "ï¼ª", "á›•", "á’ª", "ğ“‚", "â“", "ğ•†", "Æ¤", "ğ“†", "Ğ³", "ğ’", "Ñ‚", "Ç—", "ğ¯", "Å´", "ğ—", "ğ•ª", "ï¼º"],
        "32": ["â“", "ğ”¹", "ğ‚", "â’¹", "ğ’†", "â„±", "â’¼", "ï¼¨", "á¶¤", "ğ£", "ï½‹", "â“", "ğ“¶", "Å‡", "ğ", "â“Ÿ", "â“ ", "Ê³", "Åœ", "Å£", "á»®", "ï½–", "ğ”´", "Ğ–", "Â¥", "ï½š"]
    }

    converted_text = ''
    for count in range(0, len(fonts)):
        for char in text:
            if char.isalpha():
                char_index = ord(char.lower()) - 97
                converted_text += fonts[str(count)][char_index]
            else:
                converted_text += char

        converted_text += '\n'
        result = converted_text.split('\n')[0:-1]

    return result


def lang(text: str) -> str:
    '''This function is to identify the language of a text
    :param text:
        Your desired text
    :return:
        example: `en` or `fa`
    '''
    try:
        return langdetect.detect(text)
    except langdetect.LangDetectException:
        return 'The value of the text parameter you sent is integer. While you should have sent string'


def translator(text: str, to_lang: str = 'auto', from_lang: str = 'auto') -> dict:
    '''This API, which is based on the Google Translate API, is used to translate texts'''
    session = requests.session()
    base_url: str = 'https://translate.google.com'
    url: str = f'{base_url}/m?tl={to_lang}&sl={from_lang}&q={urllib.parse.quote(text)}'
    r = session.request(
        method='get', url=url, headers={
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'
        }
    )

    if r.status_code == 200:
        result = re.findall(r'(?s)class="(?:t0|result-container)">(.*?)<', r.text)
        return html.unescape(result[0])
    else:
        return 'A problem has occurred'


def fake(count: int = 100, lang: str = 'en_US') -> str:
    '''This api is used to generate fake text
    :param count
        Number of words, example >>> `10`
    :param lang
        desired language, example >>> `en_US` or `fa_IR`

    '''
    text: list = []
    __fake = faker.Faker([lang])
    # for _ in range(0, count):
    #     text.append(__fake.text())

    return __fake.text(count)
